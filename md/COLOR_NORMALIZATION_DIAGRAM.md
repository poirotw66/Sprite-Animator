# Color Normalization Process Diagram
# é¡è‰²æ¨™æº–åŒ–æµç¨‹åœ–

## Problem: AI-Generated Color Variations (å•é¡Œ: AI ç”Ÿæˆçš„è‰²å·®)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Model Generates Sprite Sheet with Green Background         â”‚
â”‚  (AI æ¨¡åž‹ç”Ÿæˆå¸¶ç¶ å¹•èƒŒæ™¯çš„ç²¾éˆåœ–)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generated Image has Color Variations (ç”Ÿæˆçš„åœ–ç‰‡æœ‰è‰²å·®)         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Frame 1 â”‚  â”‚ Frame 2 â”‚  â”‚ Frame 3 â”‚  â”‚ Frame 4 â”‚           â”‚
â”‚  â”‚ #00FF00 â”‚  â”‚ #00C850 â”‚  â”‚ #10B145 â”‚  â”‚ #00A030 â”‚           â”‚
â”‚  â”‚  (Lime) â”‚  â”‚(Variant)â”‚  â”‚(Variant)â”‚  â”‚(Variant)â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                   â”‚
â”‚  Different RGB values! (ä¸åŒçš„ RGB å€¼!)                         â”‚
â”‚  R: 0-16   G: 160-255   B: 0-80                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Chroma Key Removal FAILS (è‰²åº¦åŽ»èƒŒå¤±æ•—)                     â”‚
â”‚                                                                   â”‚
â”‚  Target: #00B140 (R=0, G=177, B=64)                            â”‚
â”‚  Actual: Various greens (å„ç¨®ç¶ è‰²)                              â”‚
â”‚  Result: Background NOT removed (èƒŒæ™¯æ²’æœ‰åŽ»é™¤)                  â”‚
â”‚                                                                   â”‚
â”‚  ðŸ”´ Residual green tint on character edges                      â”‚
â”‚  ðŸ”´ Incomplete background removal                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Solution: Automatic Color Normalization (è§£æ±ºæ–¹æ¡ˆ: è‡ªå‹•é¡è‰²æ¨™æº–åŒ–)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Detect Background Color Variations                     â”‚
â”‚  (æ­¥é©Ÿ 1: æª¢æ¸¬èƒŒæ™¯é¡è‰²è®Šé«”)                                       â”‚
â”‚                                                                   â”‚
â”‚  Scan all pixels and identify green-like colors:                â”‚
â”‚  â€¢ g > 80                                                        â”‚
â”‚  â€¢ r < 120                                                       â”‚
â”‚  â€¢ b < 150                                                       â”‚
â”‚  â€¢ g > r + 40                                                    â”‚
â”‚  â€¢ g > b                                                         â”‚
â”‚  â€¢ OR distance from #00B140 < 80                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Replace with Target Color                              â”‚
â”‚  (æ­¥é©Ÿ 2: æ›¿æ›ç‚ºç›®æ¨™é¡è‰²)                                         â”‚
â”‚                                                                   â”‚
â”‚  For each detected background pixel:                             â”‚
â”‚  data[i]   = 0    (R)                                           â”‚
â”‚  data[i+1] = 177  (G)  â† Target: #00B140                       â”‚
â”‚  data[i+2] = 64   (B)                                           â”‚
â”‚  data[i+3] = (keep original alpha for anti-aliasing)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Normalized Image (æ¨™æº–åŒ–å¾Œçš„åœ–ç‰‡)                               â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Frame 1 â”‚  â”‚ Frame 2 â”‚  â”‚ Frame 3 â”‚  â”‚ Frame 4 â”‚           â”‚
â”‚  â”‚ #00B140 â”‚  â”‚ #00B140 â”‚  â”‚ #00B140 â”‚  â”‚ #00B140 â”‚           â”‚
â”‚  â”‚  (Exact)â”‚  â”‚  (Exact)â”‚  â”‚  (Exact)â”‚  â”‚  (Exact)â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                   â”‚
â”‚  ALL frames now have EXACT #00B140 background!                  â”‚
â”‚  (æ‰€æœ‰å¹€ç¾åœ¨éƒ½æœ‰ç²¾ç¢ºçš„ #00B140 èƒŒæ™¯!)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Chroma Key Removal SUCCESS (è‰²åº¦åŽ»èƒŒæˆåŠŸ)                   â”‚
â”‚                                                                   â”‚
â”‚  Target: #00B140 (R=0, G=177, B=64)                            â”‚
â”‚  Actual: #00B140 (R=0, G=177, B=64) â† MATCH!                   â”‚
â”‚  Result: Perfect background removal (å®Œç¾ŽåŽ»èƒŒ)                  â”‚
â”‚                                                                   â”‚
â”‚  âœ¨ Clean edges on character                                    â”‚
â”‚  âœ¨ Complete background removal                                 â”‚
â”‚  âœ¨ No residual color tint                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Complete Workflow (å®Œæ•´å·¥ä½œæµç¨‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Generationâ”‚
â”‚ (AI ç”Ÿæˆ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Color Normalization  â”‚ â† NEW STEP (æ–°æ­¥é©Ÿ)
â”‚ (é¡è‰²æ¨™æº–åŒ–)          â”‚   Automatic (è‡ªå‹•)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Fast (å¿«é€Ÿ)
       â”‚                    Accurate (ç²¾ç¢º)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chroma Key Removal   â”‚
â”‚ (è‰²åº¦åŽ»èƒŒ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sprite Sheet Slicing â”‚
â”‚ (ç²¾éˆåœ–åˆ‡åˆ†)          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Animation Export     â”‚
â”‚ (å‹•ç•«å°Žå‡º)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Color Detection Examples (é¡è‰²æª¢æ¸¬ç¯„ä¾‹)

### Magenta Detection (æ´‹ç´…è‰²æª¢æ¸¬)

```
Target: #FF00FF (R=255, G=0, B=255)

âœ… WILL BE NORMALIZED (æœƒè¢«æ¨™æº–åŒ–):
   #FE00FE  (254, 0, 254)   â† Very close
   #FC00FC  (252, 0, 252)   â† Close
   #FF10FF  (255, 16, 255)  â† G slightly high but still magenta-like
   #F800F8  (248, 0, 248)   â† Within tolerance
   
âŒ WILL NOT BE NORMALIZED (ä¸æœƒè¢«æ¨™æº–åŒ–):
   #FF69B4  (255, 105, 180) â† Pink (G too high)
   #800080  (128, 0, 128)   â† Purple (R, B too low)
   #E91E63  (233, 30, 99)   â† Pink shade (G too high)
```

### Green Detection (ç¶ è‰²æª¢æ¸¬)

```
Target: #00B140 (R=0, G=177, B=64)

âœ… WILL BE NORMALIZED (æœƒè¢«æ¨™æº–åŒ–):
   #00FF00  (0, 255, 0)     â† Lime green (green-like)
   #00C850  (0, 200, 80)    â† Close variant
   #10B145  (16, 177, 69)   â† Very close
   #00A030  (0, 160, 48)    â† Darker green
   
âŒ WILL NOT BE NORMALIZED (ä¸æœƒè¢«æ¨™æº–åŒ–):
   #32CD32  (50, 205, 50)   â† Lime green (R too high)
   #ADFF2F  (173, 255, 47)  â† Yellow-green (R too high)
   #006400  (0, 100, 0)     â† Dark green (G too low)
```

## Performance Metrics (æ•ˆèƒ½æŒ‡æ¨™)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image Size       â”‚ Processing Time â”‚ Memory Usage          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 512x512 (0.3MP)  â”‚ ~50-100ms       â”‚ ~4MB                 â”‚
â”‚ 1024x1024 (1MP)  â”‚ ~150-250ms      â”‚ ~16MB                â”‚
â”‚ 1920x1080 (2MP)  â”‚ ~250-400ms      â”‚ ~32MB                â”‚
â”‚ 2048x2048 (4MP)  â”‚ ~400-600ms      â”‚ ~64MB                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Notes:
â€¢ Client-side processing (å®¢æˆ¶ç«¯è™•ç†)
â€¢ No API calls required (ç„¡éœ€ API è«‹æ±‚)
â€¢ Temporary memory (è‡¨æ™‚è¨˜æ†¶é«”)
â€¢ Fast cleanup (å¿«é€Ÿæ¸…ç†)
```

## Benefits Summary (å„ªå‹¢ç¸½çµ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  Before Normalization (æ¨™æº–åŒ–å‰):                              â”‚
â”‚  âŒ Color variations cause background removal failure          â”‚
â”‚  âŒ Manual color correction needed                             â”‚
â”‚  âŒ Inconsistent results                                       â”‚
â”‚  âŒ Time-consuming troubleshooting                             â”‚
â”‚                                                                 â”‚
â”‚  After Normalization (æ¨™æº–åŒ–å¾Œ):                               â”‚
â”‚  âœ… Perfect background removal every time                      â”‚
â”‚  âœ… Fully automatic - no user intervention                     â”‚
â”‚  âœ… Consistent, reliable results                               â”‚
â”‚  âœ… Fast processing with no extra API costs                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Technical Implementation**: See [BACKGROUND_COLOR_NORMALIZATION.md](./BACKGROUND_COLOR_NORMALIZATION.md)  
**Testing Guide**: See [TEST_COLOR_NORMALIZATION.md](./TEST_COLOR_NORMALIZATION.md)  
**Version**: v1.2.0  
**Date**: 2026-01-30
